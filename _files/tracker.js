var Mindbox,__extends,DirectCrm;(function(n,t){"use strict";typeof exports=="object"?module.exports=t():n.returnExports=t()})(this,function(){function g(n){var t=typeof n;return n===null||t==="undefined"||t==="boolean"||t==="number"||t==="string"}var t=Array.prototype,p=Object.prototype,ft=Function.prototype,e=String.prototype,et=Number.prototype,c=t.slice,ot=t.splice,ri=t.push,ui=t.unshift,fi=ft.call,s=p.toString,w=Array.isArray||function(n){return s.call(n)==="[object Array]"},b=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",u,ei=Function.prototype.toString,oi=function(n){try{return ei.call(n),!0}catch(t){return!1}},si="[object Function]",hi="[object GeneratorFunction]",d,i,r,l,a,st,ht,ct,nt,tt,at,vt,pt,it,kt,dt,n,rt,ut,ni,ti,ii;u=function(n){if(typeof n!="function")return!1;if(b)return oi(n);var t=s.call(n);return t===si||t===hi};var k,ci=RegExp.prototype.exec,li=function(n){try{return ci.call(n),!0}catch(t){return!1}},ai="[object RegExp]";k=function(n){return typeof n!="object"?!1:b?li(n):s.call(n)===ai};var f,vi=String.prototype.valueOf,yi=function(n){try{return vi.call(n),!0}catch(t){return!1}},pi="[object String]";f=function(n){return typeof n=="string"?!0:typeof n!="object"?!1:b?yi(n):s.call(n)===pi};d=function(n){var i=s.call(n),t=i==="[object Arguments]";return t||(t=!w(n)&&n!==null&&typeof n=="object"&&typeof n.length=="number"&&n.length>=0&&u(n.callee)),t};i=function(n){var i=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(n){return!1}}(),t;return t=i?function(n,t,i,r){!r&&t in n||Object.defineProperty(n,t,{configurable:!0,enumerable:!1,writable:!0,value:i})}:function(n,t,i,r){!r&&t in n||(n[t]=i)},function(i,r,u){for(var f in r)n.call(r,f)&&t(i,f,r[f],u)}}(p.hasOwnProperty);r={ToInteger:function(n){var t=+n;return t!==t?t=0:t!==0&&t!==1/0&&t!==-(1/0)&&(t=(t>0||-1)*Math.floor(Math.abs(t))),t},ToPrimitive:function(n){var t,i,r;if(g(n))return n;if((i=n.valueOf,u(i)&&(t=i.call(n),g(t)))||(r=n.toString,u(r)&&(t=r.call(n),g(t))))return t;throw new TypeError;},ToObject:function(n){if(n==null)throw new TypeError("can't convert "+n+" to object");return Object(n)},ToUint32:function(n){return n>>>0}};l=function(){};i(ft,{bind:function(n){var t=this,r;if(!u(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);var f=c.call(arguments,1),i,o=function(){if(this instanceof i){var r=t.apply(this,f.concat(c.call(arguments)));return Object(r)===r?r:this}return t.apply(n,f.concat(c.call(arguments)))},s=Math.max(0,t.length-f.length),e=[];for(r=0;r<s;r++)e.push("$"+r);return i=Function("binder","return function ("+e.join(",")+"){ return binder.apply(this, arguments); }")(o),t.prototype&&(l.prototype=t.prototype,i.prototype=new l,l.prototype=null),i}});a=fi.bind(p.hasOwnProperty);st=function(){var n=[1,2],t=n.splice();return n.length===2&&w(t)&&t.length===0}();i(t,{splice:function(){return arguments.length===0?[]:ot.apply(this,arguments)}},!st);ht=function(){var n={};return t.splice.call(n,0,0,1),n.length===1}();i(t,{splice:function(n,t){if(arguments.length===0)return[];var i=arguments;return this.length=Math.max(r.ToInteger(this.length),0),arguments.length>0&&typeof t!="number"&&(i=c.call(arguments),i.length<2?i.push(this.length-n):i[1]=r.ToInteger(t)),ot.apply(this,i)}},!ht);ct=[].unshift(0)!==1;i(t,{unshift:function(){return ui.apply(this,arguments),this.length}},ct);i(Array,{isArray:w});var lt=Object("a"),o=lt[0]!=="a"||!(0 in lt),h=function(n){var t=!0,i=!0;return n&&(n.call(["f","o","o"],function(n,i,r){typeof r!="object"&&(t=!1)}),n.call([1],function(){"use strict";i=typeof this=="string"},"x")),!!n&&t&&i};i(t,{forEach:function(n){var e=r.ToObject(this),i=o&&f(this)?this.split(""):e,s=arguments[1],t=-1,h=i.length>>>0;if(!u(n))throw new TypeError;while(++t<h)t in i&&n.call(s,i[t],t,e)}},!h(t.forEach));i(t,{map:function(n){var e=r.ToObject(this),i=o&&f(this)?this.split(""):e,s=i.length>>>0,h=Array(s),c=arguments[1],t;if(!u(n))throw new TypeError(n+" is not a function");for(t=0;t<s;t++)t in i&&(h[t]=n.call(c,i[t],t,e));return h}},!h(t.map));i(t,{filter:function(n){var s=r.ToObject(this),i=o&&f(this)?this.split(""):s,c=i.length>>>0,h=[],e,l=arguments[1],t;if(!u(n))throw new TypeError(n+" is not a function");for(t=0;t<c;t++)t in i&&(e=i[t],n.call(l,e,t,s)&&h.push(e));return h}},!h(t.filter));i(t,{every:function(n){var e=r.ToObject(this),i=o&&f(this)?this.split(""):e,s=i.length>>>0,h=arguments[1],t;if(!u(n))throw new TypeError(n+" is not a function");for(t=0;t<s;t++)if(t in i&&!n.call(h,i[t],t,e))return!1;return!0}},!h(t.every));i(t,{some:function(n){var e=r.ToObject(this),i=o&&f(this)?this.split(""):e,s=i.length>>>0,h=arguments[1],t;if(!u(n))throw new TypeError(n+" is not a function");for(t=0;t<s;t++)if(t in i&&n.call(h,i[t],t,e))return!0;return!1}},!h(t.some));nt=!1;t.reduce&&(nt=typeof t.reduce.call("es5",function(n,t,i,r){return r})=="object");i(t,{reduce:function(n){var h=r.ToObject(this),i=o&&f(this)?this.split(""):h,s=i.length>>>0,t,e;if(!u(n))throw new TypeError(n+" is not a function");if(!s&&arguments.length===1)throw new TypeError("reduce of empty array with no initial value");if(t=0,arguments.length>=2)e=arguments[1];else do{if(t in i){e=i[t++];break}if(++t>=s)throw new TypeError("reduce of empty array with no initial value");}while(1);for(;t<s;t++)t in i&&(e=n.call(void 0,e,i[t],t,h));return e}},!nt);tt=!1;t.reduceRight&&(tt=typeof t.reduceRight.call("es5",function(n,t,i,r){return r})=="object");i(t,{reduceRight:function(n){var s=r.ToObject(this),e=o&&f(this)?this.split(""):s,h=e.length>>>0,i,t;if(!u(n))throw new TypeError(n+" is not a function");if(!h&&arguments.length===1)throw new TypeError("reduceRight of empty array with no initial value");if(t=h-1,arguments.length>=2)i=arguments[1];else do{if(t in e){i=e[t--];break}if(--t<0)throw new TypeError("reduceRight of empty array with no initial value");}while(1);if(t<0)return i;do t in e&&(i=n.call(void 0,i,e[t],t,s));while(t--);return i}},!tt);at=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;i(t,{indexOf:function(n){var i=o&&f(this)?this.split(""):r.ToObject(this),u=i.length>>>0,t;if(!u)return-1;for(t=0,arguments.length>1&&(t=r.ToInteger(arguments[1])),t=t>=0?t:Math.max(0,u+t);t<u;t++)if(t in i&&i[t]===n)return t;return-1}},at);vt=Array.prototype.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;i(t,{lastIndexOf:function(n){var i=o&&f(this)?this.split(""):r.ToObject(this),u=i.length>>>0,t;if(!u)return-1;for(t=u-1,arguments.length>1&&(t=Math.min(t,r.ToInteger(arguments[1]))),t=t>=0?t:u-Math.abs(t);t>=0;t--)if(t in i&&n===i[t])return t;return-1}},vt);var wi=!{toString:null}.propertyIsEnumerable("toString"),bi=function(){}.propertyIsEnumerable("prototype"),ki=!a("x","0"),yt=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],di=yt.length;i(Object,{keys:function(n){var c=u(n),s=d(n),l=n!==null&&typeof n=="object",p=l&&f(n),t,v,i,r,h,y,e,o;if(!l&&!c&&!s)throw new TypeError("Object.keys called on a non-object");if(t=[],v=bi&&c,p&&ki||s)for(i=0;i<n.length;++i)t.push(String(i));if(!s)for(r in n)v&&r==="prototype"||!a(n,r)||t.push(String(r));if(wi)for(h=n.constructor,y=h&&h.prototype===n,e=0;e<di;e++)o=yt[e],y&&o==="constructor"||!a(n,o)||t.push(o);return t}});pt=Object.keys&&function(){return Object.keys(arguments).length===2}(1,2);it=Object.keys;i(Object,{keys:function(n){return d(n)?it(t.slice.call(n)):it(n)}},!pt);var wt=-621987552e5,bt="-000001",gi=Date.prototype.toISOString&&new Date(wt).toISOString().indexOf(bt)===-1;i(Date.prototype,{toISOString:function(){var t,r,u,n,i;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");for(n=this.getUTCFullYear(),i=this.getUTCMonth(),n+=Math.floor(i/12),i=(i%12+12)%12,t=[i+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],n=(n<0?"-":n>9999?"+":"")+("00000"+Math.abs(n)).slice(0<=n&&n<=9999?-4:-6),r=t.length;r--;)u=t[r],u<10&&(t[r]="0"+u);return n+"-"+t.slice(0,2).join("-")+"T"+t.slice(2).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"}},gi);kt=function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(wt).toJSON().indexOf(bt)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(n){return!1}}();kt||(Date.prototype.toJSON=function(){var n=Object(this),i=r.ToPrimitive(n),t;if(typeof i=="number"&&!isFinite(i))return null;if(t=n.toISOString,!u(t))throw new TypeError("toISOString property is not callable");return t.call(n)});var nr=Date.parse("+033658-09-27T01:46:40.000Z")===1e15,tr=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z")),ir=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));(!Date.parse||ir||tr||!nr)&&(Date=function(n){function t(r,u,f,e,o,s,h){var c=arguments.length,l;return this instanceof n?(l=c===1&&String(r)===r?new n(t.parse(r)):c>=7?new n(r,u,f,e,o,s,h):c>=6?new n(r,u,f,e,o,s):c>=5?new n(r,u,f,e,o):c>=4?new n(r,u,f,e):c>=3?new n(r,u,f):c>=2?new n(r,u):c>=1?new n(r):new n,i(l,{constructor:t},!0),l):n.apply(this,arguments)}function r(n,t){var i=t>1?1:0;return e[t]+Math.floor((n-1969+i)/4)-Math.floor((n-1901+i)/100)+Math.floor((n-1601+i)/400)+365*(n-1970)}function o(t){return Number(new n(1970,0,1,0,0,0,t))}var f=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:(\\.\\d{1,}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),e=[0,31,59,90,120,151,181,212,243,273,304,334,365];for(var u in n)t[u]=n[u];return t.now=n.now,t.UTC=n.UTC,t.prototype=n.prototype,t.prototype.constructor=t,t.parse=function(t){var i=f.exec(t);if(i){var s=Number(i[1]),e=Number(i[2]||1)-1,h=Number(i[3]||1)-1,v=Number(i[4]||0),c=Number(i[5]||0),l=Number(i[6]||0),a=Math.floor(Number(i[7]||0)*1e3),b=Boolean(i[4]&&!i[8]),y=i[9]==="-"?1:-1,p=Number(i[10]||0),w=Number(i[11]||0),u;return v<(c>0||l>0||a>0?24:25)&&c<60&&l<60&&a<1e3&&e>-1&&e<12&&p<24&&w<60&&h>-1&&h<r(s,e+1)-r(s,e)&&(u=((r(s,e)+h)*24+v+p*y)*60,u=((u+c+w*y)*60+l)*1e3+a,b&&(u=o(u)),-864e13<=u&&u<=864e13)?u:NaN}return n.parse.apply(this,arguments)},t}(Date));Date.now||(Date.now=function(){return(new Date).getTime()});dt=et.toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||0xde0b6b3a7640080.toFixed(0)!=="1000000000000000128");n={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function(t,i){for(var u=-1,r=i;++u<n.size;)r+=t*n.data[u],n.data[u]=r%n.base,r=Math.floor(r/n.base)},divide:function(t){for(var r=n.size,i=0;--r>=0;)i+=n.data[r],n.data[r]=Math.floor(i/t),i=i%t*n.base},numToString:function(){for(var i=n.size,t="",r;--i>=0;)(t!==""||i===0||n.data[i]!==0)&&(r=String(n.data[i]),t===""?t=r:t+="0000000".slice(0,7-r.length)+r);return t},pow:function gt(n,t,i){return t===0?i:t%2==1?gt(n,t-1,i*n):gt(n*n,t/2,i)},log:function(n){for(var i=0,t=n;t>=4096;)i+=12,t/=4096;while(t>=2)i+=1,t/=2;return i}};i(et,{toFixed:function(t){var i,r,o,u,f,h,e,s;if(i=Number(t),i=i!==i?0:Math.floor(i),i<0||i>20)throw new RangeError("Number.toFixed called with invalid number of decimals");if(r=Number(this),r!==r)return"NaN";if(r<=-1e21||r>=1e21)return String(r);if(o="",r<0&&(o="-",r=-r),u="0",r>1e-21)if(f=n.log(r*n.pow(2,69,1))-69,h=f<0?r*n.pow(2,-f,1):r/n.pow(2,f,1),h*=4503599627370496,f=52-f,f>0){for(n.multiply(0,h),e=i;e>=7;)n.multiply(1e7,0),e-=7;for(n.multiply(n.pow(10,e,1),0),e=f-1;e>=23;)n.divide(8388608),e-=23;n.divide(1<<e);n.multiply(1,1);n.divide(2);u=n.numToString()}else n.multiply(0,h),n.multiply(1<<-f,0),u=n.numToString()+"0.00000000000000000000".slice(2,2+i);return i>0?(s=u.length,u=s<=i?o+"0.0000000000000000000".slice(0,i-s+2)+u:o+u.slice(0,s-i)+"."+u.slice(s-i)):u=o+u,u}},dt);rt=e.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?function(){var n=typeof/()??/.exec("")[1]=="undefined";e.split=function(t,i){var e=this,h;if(typeof t=="undefined"&&i===0)return[];if(!k(t))return rt.call(this,t,i);var f=[],l=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.extended?"x":"")+(t.sticky?"y":""),s=0,a,u,c,v,o=new RegExp(t.source,l+"g");for(e+="",n||(a=new RegExp("^"+o.source+"$(?!\\s)",l)),h=typeof i=="undefined"?-1>>>0:r.ToUint32(i),u=o.exec(e);u;){if(c=u.index+u[0].length,c>s&&(f.push(e.slice(s,u.index)),!n&&u.length>1&&u[0].replace(a,function(){for(var n=1;n<arguments.length-2;n++)typeof arguments[n]=="undefined"&&(u[n]=void 0)}),u.length>1&&u.index<e.length&&ri.apply(f,u.slice(1)),v=u[0].length,s=c,f.length>=h))break;o.lastIndex===u.index&&o.lastIndex++;u=o.exec(e)}return s===e.length?(v||!o.test(""))&&f.push(""):f.push(e.slice(s)),f.length>h?f.slice(0,h):f}}():"0".split(void 0,0).length&&(e.split=function(n,t){return typeof n=="undefined"&&t===0?[]:rt.call(this,n,t)});ut=e.replace;ni=function(){var n=[];return"x".replace(/x(.)?/g,function(t,i){n.push(i)}),n.length===1&&typeof n[0]=="undefined"}();ni||(e.replace=function(n,t){var r=u(t),f=k(n)&&/\)[*?]/.test(n.source),i;return r&&f?(i=function(i){var u=arguments.length,f=n.lastIndex,r;return n.lastIndex=0,r=n.exec(i)||[],n.lastIndex=f,r.push(arguments[u-2],arguments[u-1]),t.apply(this,r)},ut.call(this,n,i)):ut.call(this,n,t)});ti=e.substr;ii="".substr&&"0b".substr(-1)!=="b";i(e,{substr:function(n,t){var i=n;return n<0&&(i=Math.max(this.length+n,0)),ti.call(this,i,t)}},ii);var v="\t\n\x0b\f\r   ᠎             　\u2028\u2029﻿",y="["+v+"]",rr=new RegExp("^"+y+y+"*"),ur=new RegExp(y+y+"*$"),fr=e.trim&&(v.trim()||!"​".trim());i(e,{trim:function(){if(typeof this=="undefined"||this===null)throw new TypeError("can't convert "+this+" to object");return String(this).replace(rr,"").replace(ur,"")}},fr);(parseInt(v+"08")!==8||parseInt(v+"0x16")!==22)&&(parseInt=function(n){var t=/^0[xX]/;return function(i,r){var u=String(i).trim(),f=Number(r)||(t.test(u)?16:10);return n(u,f)}}(parseInt))}),function(n,t){"use strict";typeof exports=="object"?module.exports=t():n.returnExports=t()}(this,function(){function a(n){try{return n.sentinel=0,Object.getOwnPropertyDescriptor(n,"sentinel").value===0}catch(t){return!1}}function b(n){try{return Object.defineProperty(n,"sentinel",{}),"sentinel"in n}catch(t){return!1}}var t=Function.prototype.call,n=Object.prototype,i=t.bind(n.hasOwnProperty),c,l,o,s,r=i(n,"__defineGetter__"),v,y,u,p,h,w,k,d,f,e;if(r&&(c=t.bind(n.__defineGetter__),l=t.bind(n.__defineSetter__),o=t.bind(n.__lookupGetter__),s=t.bind(n.__lookupSetter__)),Object.getPrototypeOf||(Object.getPrototypeOf=function(t){var i=t.__proto__;return i||i===null?i:t.constructor?t.constructor.prototype:n}),Object.defineProperty&&(v=a({}),y=typeof document=="undefined"||a(document.createElement("div")),y&&v||(u=Object.getOwnPropertyDescriptor)),(!Object.getOwnPropertyDescriptor||u)&&(p="Object.getOwnPropertyDescriptor called on a non-object: ",Object.getOwnPropertyDescriptor=function(t,f){var e,a,l,h,c;if(typeof t!="object"&&typeof t!="function"||t===null)throw new TypeError(p+t);if(u)try{return u.call(Object,t,f)}catch(v){}return i(t,f)?(e={enumerable:!0,configurable:!0},r&&(a=t.__proto__,l=t!==n,l&&(t.__proto__=n),h=o(t,f),c=s(t,f),l&&(t.__proto__=a),h||c))?(h&&(e.get=h),c&&(e.set=c),e):(e.value=t[f],e.writable=!0,e):e}),Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(n){return Object.keys(n)}),Object.create||(w=!({__proto__:null}instanceof Object),h=w||typeof document=="undefined"?function(){return{__proto__:null}}:function(){function i(){}var t=document.createElement("iframe"),r=document.body||document.documentElement,n;return t.style.display="none",r.appendChild(t),t.src="javascript:",n=t.contentWindow.Object.prototype,r.removeChild(t),t=null,delete n.constructor,delete n.hasOwnProperty,delete n.propertyIsEnumerable,delete n.isPrototypeOf,delete n.toLocaleString,delete n.toString,delete n.valueOf,n.__proto__=null,i.prototype=n,h=function(){return new i},new i},Object.create=function(n,t){function r(){}var i;if(n===null)i=h();else{if(typeof n!="object"&&typeof n!="function")throw new TypeError("Object prototype may only be an Object or null");r.prototype=n;i=new r;i.__proto__=n}return t!==void 0&&Object.defineProperties(i,t),i}),Object.defineProperty&&(k=b({}),d=typeof document=="undefined"||b(document.createElement("div")),k&&d||(f=Object.defineProperty,e=Object.defineProperties)),!Object.defineProperty||f){var g="Property description must be an object: ",nt="Object.defineProperty called on non-object: ",tt="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(t,i,u){if(typeof t!="object"&&typeof t!="function"||t===null)throw new TypeError(nt+t);if(typeof u!="object"&&typeof u!="function"||u===null)throw new TypeError(g+u);if(f)try{return f.call(Object,t,i,u)}catch(h){}if("value"in u)if(r&&(o(t,i)||s(t,i))){var e=t.__proto__;t.__proto__=n;delete t[i];t[i]=u.value;t.__proto__=e}else t[i]=u.value;else{if(!r)throw new TypeError(tt);"get"in u&&c(t,i,u.get);"set"in u&&l(t,i,u.set)}return t}}(!Object.defineProperties||e)&&(Object.defineProperties=function(n,t){if(e)try{return e.call(Object,n,t)}catch(u){}for(var r in t)i(t,r)&&r!=="__proto__"&&Object.defineProperty(n,r,t[r]);return n});Object.seal||(Object.seal=function(n){if(Object(n)!==n)throw new TypeError("Object.seal can only be called on Objects.");return n});Object.freeze||(Object.freeze=function(n){if(Object(n)!==n)throw new TypeError("Object.freeze can only be called on Objects.");return n});try{Object.freeze(function(){})}catch(ct){Object.freeze=function(n){return function(t){return typeof t=="function"?t:n(t)}}(Object.freeze)}Object.preventExtensions||(Object.preventExtensions=function(n){if(Object(n)!==n)throw new TypeError("Object.preventExtensions can only be called on Objects.");return n});Object.isSealed||(Object.isSealed=function(n){if(Object(n)!==n)throw new TypeError("Object.isSealed can only be called on Objects.");return!1});Object.isFrozen||(Object.isFrozen=function(n){if(Object(n)!==n)throw new TypeError("Object.isFrozen can only be called on Objects.");return!1});Object.isExtensible||(Object.isExtensible=function(n){var t,r;if(Object(n)!==n)throw new TypeError("Object.isExtensible can only be called on Objects.");for(t="";i(n,t);)t+="?";return n[t]=!0,r=i(n,t),delete n[t],r})}),function(n){"use strict";n.console=n.console||{};for(var t=n.console,i,r,u={},f=function(){},e="memory".split(","),o="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");i=e.pop();)t[i]||(t[i]=u);while(r=o.pop())t[r]||(t[r]=f)}(typeof window=="undefined"?this:window),function(){function r(t,u){function l(n){var t,i,f,r;if(l[n]!==h)return l[n];if("bug-string-char-index"==n)t="a"!="a"[0];else if("json"==n)t=l("json-stringify")&&l("json-parse");else{if("json-stringify"==n){if(t=u.stringify,f="function"==typeof t&&c,f){(i=function(){return 1}).toJSON=i;try{f="0"===t(0)&&"0"===t(new ot)&&'""'==t(new rt)&&t(o)===h&&t(h)===h&&t()===h&&"1"===t(i)&&"[1]"==t([i])&&"[null]"==t([h])&&"null"==t(null)&&"[null,null,null]"==t([h,o,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==t({a:[i,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===t(null,i)&&"[\n 1,\n 2\n]"==t([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==t(new b(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==t(new b(864e13))&&'"-000001-01-01T00:00:00.000Z"'==t(new b(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==t(new b(-1))}catch(e){f=!1}}t=f}if("json-parse"==n){if(t=u.parse,"function"==typeof t)try{if(0===t("0")&&!t(!1)&&(i=t('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'),r=5==i.a.length&&1===i.a[0],r)){try{r=!t('"\t"')}catch(s){}if(r)try{r=1!==t("01")}catch(a){}if(r)try{r=1!==t("1.")}catch(v){}}}catch(y){r=!1}t=r}}return l[n]=!!t}var w;t||(t=n.Object());u||(u=n.Object());var ot=t.Number||n.Number,rt=t.String||n.String,nt=t.Object||n.Object,b=t.Date||n.Date,st=t.SyntaxError||n.SyntaxError,ht=t.TypeError||n.TypeError,ct=t.Math||n.Math,d=t.JSON||n.JSON;"object"==typeof d&&d&&(u.stringify=d.stringify,u.parse=d.parse);var nt=nt.prototype,o=nt.toString,s,p,h,c=new b(-0xc782b5b800cec);try{c=-109252==c.getUTCFullYear()&&0===c.getUTCMonth()&&1===c.getUTCDate()&&10==c.getUTCHours()&&37==c.getUTCMinutes()&&6==c.getUTCSeconds()&&708==c.getUTCMilliseconds()}catch(pt){}if(!l("json")){if(w=l("bug-string-char-index"),!c)var a=ct.floor,lt=[0,31,59,90,120,151,181,212,243,273,304,334],k=function(n,t){return lt[t]+365*(n-1970)+a((n-1969+(t=+(1<t)))/4)-a((n-1901+t)/100)+a((n-1601+t)/400)};if((s=nt.hasOwnProperty)||(s=function(n){var t={},i;return(t.__proto__=null,t.__proto__={toString:1},t).toString!=o?s=function(n){var t=this.__proto__;return n=n in(this.__proto__=null,this),this.__proto__=t,n}:(i=t.constructor,s=function(n){var t=(this.constructor||i).prototype;return n in this&&!(n in t&&this[n]===t[n])}),t=null,s.call(this,n)}),p=function(n,t){var u=0,f,r,e;(f=function(){this.valueOf=0}).prototype.valueOf=0;r=new f;for(e in r)s.call(r,e)&&u++;return f=r=null,u?p=2==u?function(n,t){var r={},u="[object Function]"==o.call(n);for(var i in n)(!u||"prototype"!=i)&&!s.call(r,i)&&(r[i]=1)&&s.call(n,i)&&t(i)}:function(n,t){var u="[object Function]"==o.call(n),i,r;for(i in n)u&&"prototype"==i||!s.call(n,i)||(r="constructor"===i)||t(i);(r||s.call(n,i="constructor"))&&t(i)}:(r="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),p=function(n,t){var f="[object Function]"==o.call(n),u,e=!f&&"function"!=typeof n.constructor&&i[typeof n.hasOwnProperty]&&n.hasOwnProperty||s;for(u in n)f&&"prototype"==u||!e.call(n,u)||t(u);for(f=r.length;u=r[--f];e.call(n,u)&&t(u));}),p(n,t)},!l("json-stringify")){var at={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},v=function(n,t){return("000000"+(t||0)).slice(-n)},ut=function(n){for(var i,r='"',t=0,u=n.length,f=!w||10<u,e=f&&(w?n.split(""):n);t<u;t++){i=n.charCodeAt(t);switch(i){case 8:case 9:case 10:case 12:case 13:case 34:case 92:r+=at[i];break;default:if(32>i){r+="\\u00"+v(2,i.toString(16));break}r+=f?e[t]:n.charAt(t)}}return r+'"'},tt=function(n,t,i,r,u,f,e){var c,l,y,w,d,g,nt,it,b;try{c=t[n]}catch(rt){}if("object"==typeof c&&c)if(l=o.call(c),"[object Date]"!=l||s.call(c,"toJSON"))"function"==typeof c.toJSON&&("[object Number]"!=l&&"[object String]"!=l&&"[object Array]"!=l||s.call(c,"toJSON"))&&(c=c.toJSON(n));else if(c>-1/0&&c<1/0){if(k){for(w=a(c/864e5),l=a(w/365.2425)+1970-1;k(l+1,0)<=w;l++);for(y=a((w-k(l,0))/30.42);k(l,y+1)<=w;y++);w=1+w-k(l,y);d=(c%864e5+864e5)%864e5;g=a(d/36e5)%24;nt=a(d/6e4)%60;it=a(d/1e3)%60;d%=1e3}else l=c.getUTCFullYear(),y=c.getUTCMonth(),w=c.getUTCDate(),g=c.getUTCHours(),nt=c.getUTCMinutes(),it=c.getUTCSeconds(),d=c.getUTCMilliseconds();c=(0>=l||1e4<=l?(0>l?"-":"+")+v(6,0>l?-l:l):v(4,l))+"-"+v(2,y+1)+"-"+v(2,w)+"T"+v(2,g)+":"+v(2,nt)+":"+v(2,it)+"."+v(3,d)+"Z"}else c=null;if(i&&(c=i.call(t,n,c)),null===c)return"null";if(l=o.call(c),"[object Boolean]"==l)return""+c;if("[object Number]"==l)return c>-1/0&&c<1/0?""+c:"null";if("[object String]"==l)return ut(""+c);if("object"==typeof c){for(n=e.length;n--;)if(e[n]===c)throw ht();if(e.push(c),b=[],t=f,f+=u,"[object Array]"==l){for(y=0,n=c.length;y<n;y++)l=tt(y,c,i,r,u,f,e),b.push(l===h?"null":l);n=b.length?u?"[\n"+f+b.join(",\n"+f)+"\n"+t+"]":"["+b.join(",")+"]":"[]"}else p(r||c,function(n){var t=tt(n,c,i,r,u,f,e);t!==h&&b.push(ut(n)+":"+(u?" ":"")+t)}),n=b.length?u?"{\n"+f+b.join(",\n"+f)+"\n"+t+"}":"{"+b.join(",")+"}":"{}";return e.pop(),n}};u.stringify=function(n,t,r){var e,c,s,u,h,l,f;if(i[typeof t]&&t)if("[object Function]"==(u=o.call(t)))c=t;else if("[object Array]"==u)for(s={},h=0,l=t.length;h<l;f=t[h++],(u=o.call(f),"[object String]"==u||"[object Number]"==u)&&(s[f]=1));if(r)if("[object Number]"==(u=o.call(r))){if(0<(r-=r%1))for(e="",10<r&&(r=10);e.length<r;e+=" ");}else"[object String]"==u&&(e=10>=r.length?r:r.slice(0,10));return tt("",(f={},f[""]=n,f),c,s,e,"",[])}}if(!l("json-parse")){var vt=rt.fromCharCode,yt={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},f,g,e=function(){f=g=null;throw st();},y=function(){for(var t=g,o=t.length,r,u,i,s,n;f<o;)switch(n=t.charCodeAt(f),n){case 9:case 10:case 13:case 32:f++;break;case 123:case 125:case 91:case 93:case 58:case 44:return r=w?t.charAt(f):t[f],f++,r;case 34:for(r="@",f++;f<o;)if(n=t.charCodeAt(f),32>n)e();else if(92==n)switch(n=t.charCodeAt(++f),n){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:r+=yt[n];f++;break;case 117:for(u=++f,i=f+4;f<i;f++)n=t.charCodeAt(f),48<=n&&57>=n||97<=n&&102>=n||65<=n&&70>=n||e();r+=vt("0x"+t.slice(u,f));break;default:e()}else{if(34==n)break;for(n=t.charCodeAt(f),u=f;32<=n&&92!=n&&34!=n;)n=t.charCodeAt(++f);r+=t.slice(u,f)}if(34==t.charCodeAt(f))return f++,r;e();default:if(u=f,45==n&&(s=!0,n=t.charCodeAt(++f)),48<=n&&57>=n){for(48==n&&(n=t.charCodeAt(f+1),48<=n&&57>=n)&&e();f<o&&(n=t.charCodeAt(f),48<=n&&57>=n);f++);if(46==t.charCodeAt(f)){for(i=++f;i<o&&(n=t.charCodeAt(i),48<=n&&57>=n);i++);i==f&&e();f=i}if(n=t.charCodeAt(f),101==n||69==n){for(n=t.charCodeAt(++f),43!=n&&45!=n||f++,i=f;i<o&&(n=t.charCodeAt(i),48<=n&&57>=n);i++);i==f&&e();f=i}return+t.slice(u,f)}if(s&&e(),"true"==t.slice(f,f+4))return f+=4,!0;if("false"==t.slice(f,f+5))return f+=5,!1;if("null"==t.slice(f,f+4))return f+=4,null;e()}return"$"},it=function(n){var t,i;if("$"==n&&e(),"string"==typeof n){if("@"==(w?n.charAt(0):n[0]))return n.slice(1);if("["==n){for(t=[];;i||(i=!0)){if(n=y(),"]"==n)break;i&&(","==n?(n=y(),"]"==n&&e()):e());","==n&&e();t.push(it(n))}return t}if("{"==n){for(t={};;i||(i=!0)){if(n=y(),"}"==n)break;i&&(","==n?(n=y(),"}"==n&&e()):e());","!=n&&"string"==typeof n&&"@"==(w?n.charAt(0):n[0])&&":"==y()||e();t[n.slice(1)]=it(y())}return t}e()}return n},ft=function(n,t,i){i=et(n,t,i);i===h?delete n[t]:n[t]=i},et=function(n,t,i){var r=n[t],u;if("object"==typeof r&&r)if("[object Array]"==o.call(r))for(u=r.length;u--;)ft(r,u,i);else p(r,function(n){ft(r,n,i)});return i.call(n,t,r)};u.parse=function(n,t){var i,r;return f=0,g=""+n,i=it(y()),"$"!=y()&&e(),f=g=null,t&&"[object Function]"==o.call(t)?et((r={},r[""]=i,r),"",t):i}}}return u.runInContext=r,u}var e=typeof define=="function"&&define.amd,i={"function":!0,object:!0},u=i[typeof exports]&&exports&&!exports.nodeType&&exports,n=i[typeof window]&&window||this,t=u&&i[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(t&&(t.global===t||t.window===t||t.self===t)&&(n=t),u&&!e)r(n,u);else{var o=n.JSON,s=n.JSON3,h=!1,f=r(n,n.JSON3={noConflict:function(){return h||(h=!0,n.JSON=o,n.JSON3=s,o=s=null),f}});n.JSON={parse:f.parse,stringify:f.stringify}}e}.call(this),function e(n,t,i){function r(u,e){var s,h,o;if(!t[u]){if(!n[u]){if(s=typeof require=="function"&&require,!e&&s)return s(u,!0);if(f)return f(u,!0);h=new Error("Cannot find module '"+u+"'");throw h.code="MODULE_NOT_FOUND",h;}o=t[u]={exports:{}};n[u][0].call(o.exports,function(t){var i=n[u][1][t];return r(i?i:t)},o,o.exports,e,n,t,i)}return t[u].exports}for(var f=typeof require=="function"&&require,u=0;u<i.length;u++)r(i[u]);return r}({1:[function(n,t){function r(){}var i=t.exports={};i.nextTick=function(){var t=typeof window!="undefined"&&window.setImmediate,i=typeof window!="undefined"&&window.postMessage&&window.addEventListener,n;return t?function(n){return window.setImmediate(n)}:i?(n=[],window.addEventListener("message",function(t){var i=t.source,r;(i===window||i===null)&&t.data==="process-tick"&&(t.stopPropagation(),n.length>0&&(r=n.shift(),r()))},!0),function(t){n.push(t);window.postMessage("process-tick","*")}):function(n){setTimeout(n,0)}}();i.title="browser";i.browser=!0;i.env={};i.argv=[];i.on=r;i.addListener=r;i.once=r;i.off=r;i.removeListener=r;i.removeAllListeners=r;i.emit=r;i.binding=function(){throw new Error("process.binding is not supported");};i.cwd=function(){return"/"};i.chdir=function(){throw new Error("process.chdir is not supported");}},{}],2:[function(n,t){"use strict";function u(n){function h(n){if(t===null){e.push(n);return}r(function(){var i=t?n.onFulfilled:n.onRejected,r;if(i===null){(t?n.resolve:n.reject)(u);return}try{r=i(u)}catch(f){n.reject(f);return}n.resolve(r)})}function c(n){try{if(n===s)throw new TypeError("A promise cannot be resolved with itself.");if(n&&(typeof n=="object"||typeof n=="function")){var r=n.then;if(typeof r=="function"){i(r.bind(n),c,o);return}}t=!0;u=n;l()}catch(f){o(f)}}function o(n){t=!1;u=n;l()}function l(){for(var n=0,t=e.length;n<t;n++)h(e[n]);e=null}if(typeof this!="object")throw new TypeError("Promises must be constructed via new");if(typeof n!="function")throw new TypeError("not a function");var t=null,u=null,e=[],s=this;this.then=function(n,t){return new s.constructor(function(i,r){h(new f(n,t,i,r))})};i(n,c,o)}function f(n,t,i,r){this.onFulfilled=typeof n=="function"?n:null;this.onRejected=typeof t=="function"?t:null;this.resolve=i;this.reject=r}function i(n,t,i){var r=!1;try{n(function(n){r||(r=!0,t(n))},function(n){r||(r=!0,i(n))})}catch(u){if(r)return;r=!0;i(u)}}var r=n("asap");t.exports=u},{asap:4}],3:[function(n,t){"use strict";function r(n){this.then=function(t){return typeof t!="function"?this:new i(function(i,r){u(function(){try{i(t(n))}catch(u){r(u)}})})}}var i=n("./core.js"),u=n("asap");t.exports=i;r.prototype=i.prototype;var f=new r(!0),e=new r(!1),o=new r(null),s=new r(undefined),h=new r(0),c=new r("");i.resolve=function(n){if(n instanceof i)return n;if(n===null)return o;if(n===undefined)return s;if(n===!0)return f;if(n===!1)return e;if(n===0)return h;if(n==="")return c;if(typeof n=="object"||typeof n=="function")try{var t=n.then;if(typeof t=="function")return new i(t.bind(n))}catch(u){return new i(function(n,t){t(u)})}return new r(n)};i.all=function(n){var t=Array.prototype.slice.call(n);return new i(function(n,i){function f(r,e){try{if(e&&(typeof e=="object"||typeof e=="function")){var o=e.then;if(typeof o=="function"){o.call(e,function(n){f(r,n)},i);return}}t[r]=e;--u==0&&n(t)}catch(s){i(s)}}var u,r;if(t.length===0)return n([]);for(u=t.length,r=0;r<t.length;r++)f(r,t[r])})};i.reject=function(n){return new i(function(t,i){i(n)})};i.race=function(n){return new i(function(t,r){n.forEach(function(n){i.resolve(n).then(t,r)})})};i.prototype["catch"]=function(n){return this.then(null,n)}},{"./core.js":2,asap:4}],4:[function(n,t){(function(n){function r(){for(var t,n;i.next;){i=i.next;t=i.task;i.task=void 0;n=i.domain;n&&(i.domain=void 0,n.enter());try{t()}catch(u){if(e){n&&n.exit();setTimeout(r,0);n&&n.enter();throw u;}else setTimeout(function(){throw u;},0)}n&&n.exit()}f=!1}function h(t){s=s.next={task:t,domain:e&&n.domain,next:null};f||(f=!0,u())}var i={task:void 0,next:null},s=i,f=!1,u=void 0,e=!1,o;typeof n!="undefined"&&n.nextTick?(e=!0,u=function(){n.nextTick(r)}):typeof setImmediate=="function"?u=typeof window!="undefined"?setImmediate.bind(window,r):function(){setImmediate(r)}:typeof MessageChannel!="undefined"?(o=new MessageChannel,o.port1.onmessage=r,u=function(){o.port2.postMessage(0)}):u=function(){setTimeout(r,0)};t.exports=h}).call(this,n("_process"))},{_process:1}],5:[function(){typeof Promise.prototype.done!="function"&&(Promise.prototype.done=function(){var n=arguments.length?this.then.apply(this,arguments):this;n.then(null,function(n){setTimeout(function(){throw n;},0)})})},{}],6:[function(n){var t=n("asap");(typeof Promise=="undefined"||typeof Promise.race=="undefined")&&(Promise=n("./lib/core.js"),n("./lib/es6-extensions.js"));n("./polyfill-done.js")},{"./lib/core.js":2,"./lib/es6-extensions.js":3,"./polyfill-done.js":5,asap:4}]},{},[6]),function(n){var t;(function(n){var i=function(){function n(n,t,i,r){this._pluses=/\+/g;this._navigator=n?n.navigator:navigator;this._document=n?n.document:document;this._domain=t;this._path=i;this._secure=r}return n.prototype.remove=function(n,i){return this.tryGet(n,t.Raw)==null?!1:(this.set(n,"",-1,t.Raw,i),!this.tryGet(n,t.Raw))},n.prototype.tryGetJson=function(n){return this.tryGet(n,t.Json)},n.prototype.tryGet=function(n,i){var e=null,u,f,r,o;for(typeof i=="undefined"&&(i=t.String),u=this._document.cookie,f=u?u.split("; "):[],r=0,o=f.length;r<o;r++){var s=f[r].split("="),h=this.decode(s.shift(),i),c=s.join("=");if(n===h){e=this.read(c,i);break}}return e},n.prototype.setJson=function(n,i,r){return this.set(n,i,r,t.Json)},n.prototype.set=function(n,i,r,u,f){var e,o;return u===undefined&&(u=t.String),r!==-1&&this.remove(n),e=null,r!=null&&typeof r=="number"?(e=new Date,e.setTime(+e+r*864e5)):r!=null&&r instanceof Date&&(e=r),o=f==null?this._domain:f,o===this._document.domain&&(o=null),this._document.cookie=[this.encode(n,u),"=",this.stringifyCookieValue(i,u),e!=null?"; expires="+e.toUTCString():"","; path="+(this._path!=null?this._path:"/"),o?"; domain="+o:"",this._secure!=null&&this._secure?"; secure":""].join("")},n.prototype.removeAcrossBaseDomain=function(n){var i=this.getBaseDomain(),t,u,f;if(i){var e=this._document.domain,r=e.split("."),o=i.substring(1).split("."),s=r.length-o.length+1;for(t=s-1;t>=0;t--)u=r.slice(t),f="."+u.join("."),this.remove(n,f)}this.remove(n,this._document.domain)},n.prototype.isCookieEnabled=function(){try{return this._document.cookie="testcookie=testcookie",this._document.cookie.indexOf("testcookie=testcookie")!=-1?!0:!1}catch(n){return!1}},n.prototype.read=function(n,i){(i==t.Raw||i==t.String)&&n.indexOf('"')===0&&(n=n.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{n=i==t.Raw?n:decodeURIComponent(n.replace(this._pluses," "));switch(i){case t.Raw:case t.String:return n;case t.Json:return JSON.parse(n);default:throw new Error("Unknown format");}}catch(r){}},n.prototype.encode=function(n,i){switch(i){case t.Raw:return n;case t.Json:case t.String:return encodeURIComponent(n);default:throw new Error("Unknown format");}},n.prototype.decode=function(n,i){switch(i){case t.Raw:return n;case t.Json:case t.String:return decodeURIComponent(n);default:throw new Error("Unknown format");}},n.prototype.stringifyCookieValue=function(n,i){switch(i){case t.Raw:case t.String:return this.encode(String(n),i);case t.Json:return this.encode(JSON.stringify(n),i);default:throw new Error("Unknown format");}},n.prototype.setBaseDomain=function(){this._domain=this.getBaseDomain()},n.prototype.getBaseDomain=function(){return this._baseDomain||(this._baseDomain=this.computeBaseDomain()),this._baseDomain},n.prototype.computeBaseDomain=function(){var t,n,i;if(!this.isCookieEnabled())return null;for(t=this._document.domain?"."+this._document.domain:"",n=t.length-1;;){if(n<=0)return null;while(n>=0&&t[n]!==".")n--;if(i=t.substr(n),this._document.cookie="domaintest=value; path=/; domain="+i,this._document.cookie.indexOf("domaintest=value")!==-1)return this._document.cookie="domaintest=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; domain="+i,i;n--}},n}(),t;n.Manager=i,function(n){n[n.Json=0]="Json";n[n.String=1]="String";n[n.Raw=2]="Raw"}(n.Format||(n.Format={}));t=n.Format})(t=n.Cookies||(n.Cookies={}))}(Mindbox||(Mindbox={})),function(n){var t=function(){function t(n,t,i){this._logError=n;this._window=i?i:window;this._cookieManager=t}return t.prototype.tryGetSession=function(){var u=this._cookieManager.tryGetJson(t.storageKey),r,i;if(u)return u;try{if(r=this._window.localStorage[t.storageKey],r)if(i=JSON.parse(r),typeof i.sessionGuid=="undefined"||typeof i.expirationDateTicks!="undefined")this._window.localStorage.removeItem(t.storageKey);else return this._logError(new n.Warning("Session cookie has been lost.")),this._cookieManager.setJson(t.storageKey,i),i}catch(f){}return null},t.prototype.setSession=function(n){var i=new Date,r=new Date(i.getFullYear()+2,i.getMonth(),i.getDate());this._cookieManager.removeAcrossBaseDomain(t.storageKey);this._cookieManager.setJson(t.storageKey,n,r);try{this._window.localStorage[t.storageKey]=JSON.stringify(n)}catch(u){}},t.storageKey="directCrm-session",t}();n.CustomerSessionStorage=t}(DirectCrm||(DirectCrm={})),function(n){var t=function(){function n(){}return n.GET="GET",n.POST="POST",n.PUT="PUT",n.DELETE="DELETE",n}(),i;n.HttpMethods=t;i=function(){function i(n,t,i){this._requestTimeout=3e4;this._serviceDomain=n;this._projectDomain=t;this._useHttp=i?i:!1}return i.prototype.getProtocol=function(){return this._useHttp?"http://":"https://"},i.prototype.log=function(r,u){if(!(r instanceof n.HttpError)||r.statusCode!==400){u||(u="tracker.directcrm.ru");var f=u+"/v1.1/error/log?revision="+n.revision,e=i.serialize(this.generateErrorMessage(r));this.sendByJsonp(this.getProtocol()+f,e)||this.sendByXmlHttpRequest(this.getProtocol()+f,t.POST,e)||this.sendByXDomainRequest(this.getProtocol()+f,t.POST,e)}},i.prototype.sendToTracker=function(n,t,i){return this.send(this._serviceDomain+n,t,i,!0)},i.prototype.sendToDirectCrm=function(t,i,r){if(!this._projectDomain)throw new n.Warning("You should initialize tracker with projectDomain property.");return this.send(this._projectDomain+t,i,r,!1)},i.prototype.send=function(t,r,u,f){t=this.getProtocol()+t+(t.match(/\?/)?"&":"?")+"revision="+n.revision;var o=i.serialize(u),e=this.sendByXmlHttpRequest(t,r,o)||this.sendByJsonp(t,o);if(!e&&(f||location.protocol==t.substring(0,t.indexOf(":")))&&(e=this.sendByXDomainRequest(t,r,o)),e==null)throw new n.Warning("Неподдерживаемый браузер");return e},i.prototype.sendByXmlHttpRequest=function(i,r,u){var f,e;return typeof XMLHttpRequest=="undefined"?null:(f=new XMLHttpRequest,!("withCredentials"in f))?null:(r==t.GET&&(i+="&"+u),f.open(r,i,!0),f.timeout=this._requestTimeout,f.setRequestHeader("Accept","application/json"),f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e=new Promise(function(t,i){f.onreadystatechange=function(){f.readyState==4&&(f.status>=200&&f.status<300?t(JSON.parse(f.responseText)):f.status==0?i(new n.Timeout("Timeout in sendByXmlHttpRequest.")):i(new n.HttpError(f.status,"xhr is statusText = "+f.statusText+", status = "+f.status+",  response = "+f.response)))}}),r==t.GET?f.send():f.send(u),e)},i.prototype.sendByXDomainRequest=function(i,r,u){var f;return typeof XDomainRequest=="undefined"?null:(i.indexOf(location.protocol)!==0&&(i=location.protocol+i.substring(i.indexOf(":")+1)),r==t.GET&&(i+="&"+u),f=new XDomainRequest,f.open(r,i),f.timeout=this._requestTimeout,new Promise(function(e,o){f.onload=function(){return e(JSON.parse(f.responseText))};f.ontimeout=function(){return o(new n.Timeout("Timeout in sendByXDomainRequest."))};f.onerror=function(t){return o(new n.Warning("Url: "+i+". "+(t?JSON.stringify(t):"Unknown error in sendByXDomainRequest.")))};r==t.GET?f.send():f.send(u)}))},i.prototype.sendByJsonp=function(t,r){var s=this,e="_jsonp_"+i.unique++,u,f,o;return(t+="&"+r+'&jsonpCallback=DirectCrm["'+e+'"]',t.length>i.maxUrlLength)?null:(u=document.createElement("script"),u.type="text/javascript",u.src=t,f=new Promise(function(t){n[e]=function(i){try{t(i)}finally{document.getElementsByTagName("head")[0].removeChild(u);u=null;delete n[e]}}}),document.getElementsByTagName("head")[0].appendChild(u),o=new Promise(function(t,i){setTimeout(function(){i(new n.Timeout("Timeout in sendByJsonp."))},s._requestTimeout)}),f=f.then(function(t){if(t.IsError)throw new n.HttpError(t.HttpStatusCode,t.ErrorId+" HttpStatusCode="+t.HttpStatusCode+" "+t.ErrorMessage);else return t}),Promise.race([f,o]))},i.prototype.generateErrorMessage=function(n,t){var i={message:n.message,stackTrace:n.stack};return t&&(i.options=t),i},i.serialize=function(n,t){var e=[],u,o,r,f;for(u in n)if(n.hasOwnProperty(u))if(o=t?t+"."+u:u,r=n[u],Array.isArray(r))for(f=0;f<r.length;f++)e.push(i.serialize(r[f],o+"["+f+"]"));else typeof r=="object"?e.push(i.serialize(r,o)):e.push(encodeURIComponent(o)+"="+encodeURIComponent(r));return e.join("&")},i.maxUrlLength=2036,i.unique=0,i}();n.RequestSender=i}(DirectCrm||(DirectCrm={})),function(n){n.revision="06b08ac6e116"}(DirectCrm||(DirectCrm={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){function e(){n.isTrackerInitialized=!1;var t=new i;t.initialize(!0)}var t=function(n){function t(t){n.call(this);this.name="Warning";this.message=t;try{throw new Error;}catch(i){this.stack=i.stack}}return __extends(t,n),t}(Error),r,u,i,f;n.Warning=t;r=function(n){function t(t){n.call(this);this.name="Timeout";this.message=t;try{throw new Error;}catch(i){this.stack=i.stack}}return __extends(t,n),t}(Error);n.Timeout=r;u=function(n){function t(t,i){n.call(this);this.statusCode=t;this.name="HttpError";this.message=i;try{throw new Error;}catch(r){this.stack=r.stack}}return __extends(t,n),t}(Error);n.HttpError=u;i=function(){function i(){this._previousRequestPromise=undefined}return i.prototype.initialize=function(){var u,f,i,r;try{if(n.isTrackerInitialized)throw new t("You cannot initialize tracker more than 1 time");for(u=window.directCrm&&window.directCrm.Queue?window.directCrm.Queue:[],f=this,window.directCrm=function(){var n=Array.prototype.slice.call(arguments);f.process(n.shift(),n)},i=0;i<u.length;++i)r=Array.prototype.slice.call(u[i]),r[0]=="create"&&(this.process(r.shift(),r),u.splice(i,1));for(i=0;i<u.length;++i)r=Array.prototype.slice.call(u[i]),this.process(r.shift(),r);n.isTrackerInitialized=!0}catch(e){this.logError(e)}},i.prototype.isPrerenderOrPreview=function(){var n=this._window.document.visibilityState||this._window.document.webkitVisibilityState||"visible";return n=="preview"||n=="prerender"},i.prototype.tryGetCustomer=function(){return this._cookieManager.tryGetJson("customer")},i.prototype.setCustomer=function(n){var t=new Date;t.setTime(t.getTime()+18e5);this._cookieManager.setJson("customer",n,t)},i.prototype.process=function(n,i){var r=this;try{if(!n)throw new t("methodName required");if(n=n.replace(".","_"),typeof this[n]=="undefined")throw new t("Unknown method: "+n);if(n!="create"&&!this._settings)throw new t('You should call "create" first');if(n!="create"&&(!this._cookieManager.isCookieEnabled()||this.isPrerenderOrPreview()))return;n=="create"?this._previousRequestPromise?this.logError(new Error("Multiple call for create")):this.create(i[0]):i instanceof Array?this.then(function(){return r[n].apply(r,i)}):this.then(function(){return r[n].call(r,i)})}catch(u){this.logError(u)}},i.prototype.then=function(n){var t=this;this._previousRequestPromise=this._previousRequestPromise?this._previousRequestPromise.then(function(){return n()}).then(undefined,function(n){return t.logError(n)}):n().then(undefined,function(n){return t.logError(n)})},i.prototype.logError=function(n){console.log(n);this._sender&&this._sender.log(n,this._settings.serviceDomain,{projectSystemName:this._settings.projectSystemName,brandSystemName:this._settings.brandSystemName,pointOfContactSystemName:this._settings.pointOfContactSystemName})},i.prototype.create=function(i){var u=this,f;if(!i)throw new t("parameters required");if(!i.serviceDomain)throw new t("serviceDomain required");if(!i.projectSystemName)throw new t("projectSystemName required");if(!i.brandSystemName)throw new t("projectDomain required");if(!i.pointOfContactSystemName)throw new t("pointOfContactSystemName required");(this._settings=i,this._sender=i.requestSenderOverride?i.requestSenderOverride:new n.RequestSender(i.serviceDomain,i.projectDomain,i.useHttp),this._window=i.windowOverride?i.windowOverride:window,this._settings.cookieDomain==null?(this._cookieManager=new Mindbox.Cookies.Manager(this._window),this._cookieManager.setBaseDomain()):this._cookieManager=new Mindbox.Cookies.Manager(this._window,i.cookieDomain),this._sessionStorage=new n.CustomerSessionStorage(function(n){return u.logError(n)},this._cookieManager,this._window),this._cookieManager.isCookieEnabled()&&!this.isPrerenderOrPreview())&&(this._previousRequestPromise=this.trackVisit().then(undefined,function(n){return u.logError(n)}),i.customer&&this.then(function(){return u.authorize(i.customer)}),this._settings.keepAlive&&(f=setInterval(function(){u._previousRequestPromise=u._previousRequestPromise.then(function(){return u.keepAlive()}).then(undefined,function(n){n&&n instanceof r||clearInterval(f);u.logError(n)})},3e5)))},i.prototype.trackVisit=function(){var t=this,i={};return this.fillMessageData(i),this._sender.sendToTracker("/v1.1/customer/track-visit",n.HttpMethods.POST,i).then(function(n){t._sessionStorage.setSession(n.session);n.redirectUrl!=null&&t._window.location.replace(n.redirectUrl)})},i.prototype.keepAlive=function(){var i=this,t={};return this.fillMessageData(t),this._sender.sendToTracker("/v1.1/customer/keep-alive",n.HttpMethods.POST,t).then(function(n){i._sessionStorage.setSession(n.session)})},i.prototype.authenticate=function(t){var r=this,i={ticket:t};return this.fillMessageData(i),this._sender.sendToTracker("/v1.1/customer/authenticate/by-ticket",n.HttpMethods.POST,i).then(function(n){return r._sessionStorage.setSession(n.session)})},i.prototype.authorize=function(i){var u=this,r;if(!i)throw new t("parameters required");if(!i.id)throw new t("id required");if(!i.sessionKey)throw new t("sessionKey required");return this.setCustomer(i),r={customerId:i.id,sessionKey:i.sessionKey},this.fillMessageData(r),this._sender.sendToTracker("/v1.1/customer/authenticate/by-customerId-and-sessionKey",n.HttpMethods.POST,r).then(function(n){return u._sessionStorage.setSession(n.session)})},i.prototype.identify=function(i){var u=this,r;if(!i)throw new t("parameters required");if(!i.operation)throw new t("operation required");if(!i.identificator)throw new t("identificator required");return r={operation:i.operation,identity:i.identificator.identity,provider:i.identificator.provider},i.data&&(r.data=JSON.stringify(i.data)),this.fillMessageData(r),i.success||(i.success=function(){}),i.error||(i.error=function(){}),this._sender.sendToTracker("/v1.1/customer/identify",n.HttpMethods.POST,r).then(function(n){return u._sessionStorage.setSession(n.session),i.success(),null},i.error)},i.prototype.performOperation=function(i){var o=this,u,f,e,r;if(!i)throw new t("params required");if(f=function(){},e=function(){},i.success&&typeof i.success=="function"&&(f=i.success),i.error&&typeof i.error=="function"&&(e=i.error),typeof i=="string")u=i;else if(i.operation)u=i.operation;else throw new t("unknown parameter in performOperation");return r={operationSystemName:u},this.fillMessageData(r),i.data&&(r.data=JSON.stringify(i.data)),this._sender.sendToTracker("/v1.1/customer/track-event",n.HttpMethods.POST,r).then(function(n){o._sessionStorage.setSession(n.session);f()},e)},i.prototype.order_create=function(t){var f=this,u={order:t},i,r;return this.fillMessageData(u),i=function(){},r=function(){},t.success&&typeof t.success=="function"&&(i=t.success),t.error&&typeof t.error=="function"&&(r=t.error),this._sender.sendToTracker("/v1.1/order/create",n.HttpMethods.POST,u).then(function(n){f._sessionStorage.setSession(n.session);i()},r)},i.prototype.cart_addProduct=function(t){var r=this,i={item:t};return this.fillMessageData(i),this._sender.sendToTracker("/v1.1/cart/add-product",n.HttpMethods.POST,i).then(function(n){return r._sessionStorage.setSession(n.session)})},i.prototype.cart_removeProduct=function(t){var r=this,i={item:t};return this.fillMessageData(i),this._sender.sendToTracker("/v1.1/cart/remove-product",n.HttpMethods.POST,i).then(function(n){return r._sessionStorage.setSession(n.session)})},i.prototype.cart_setProductQuantity=function(t){var r=this,i={item:t};return this.fillMessageData(i),this._sender.sendToTracker("/v1.1/cart/set-product-quantity",n.HttpMethods.POST,i).then(function(n){return r._sessionStorage.setSession(n.session)})},i.prototype.cart_clear=function(){var i=this,t={};return this.fillMessageData(t),this._sender.sendToTracker("/v1.1/cart/clear",n.HttpMethods.POST,t).then(function(n){return i._sessionStorage.setSession(n.session)})},i.prototype.getSegments=function(i,r){if(!i)throw new t("OperationName required");if(!r)throw new t("Callback required");var u=this.tryGetCustomer(),f={operation:i,customerSession:encodeURIComponent(JSON.stringify(this._sessionStorage.tryGetSession())),DirectCrmBrand:this._settings.brandSystemName,DirectCrmPointOfContactSystemName:this._settings.pointOfContactSystemName};return u&&(f.DirectCrmAuthorizationCustomerId=u.id,f.DirectCrmAuthorizationSessionKey=u.sessionKey),this._sender.sendToDirectCrm("/v3/customers/current/segments",n.HttpMethods.GET,f).then(function(n){r(n)})},i.prototype.fillMessageData=function(n){n.options={projectSystemName:this._settings.projectSystemName,brandSystemName:this._settings.brandSystemName,pointOfContactSystemName:this._settings.pointOfContactSystemName};n.session=this._sessionStorage.tryGetSession();n.referrerUrl=this._window.document.referrer;n.requestUrl=this._window.document.location.href;try{n.screenResolution=window.screen.width+"x"+window.screen.height}catch(t){}},i}();n.Tracker=i;n.reinitializeTrackerForTests=e;f=new i;f.initialize(!1);n.isTrackerInitialized=!0}(DirectCrm||(DirectCrm={}))